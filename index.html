<!DOCTYPE html>
<html>
    <head>

        <!-- script de A-Frane version1 1.0.0 -->
        <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
        <!-- script de AR.JS con soporte de marker + location -->
        <script src="https://jeromeetienne.github.io/AR.js/aframe/build/aframe-ar.js"></script>
       
        <script src="https://unpkg.com/aframe-frustum-lock-component"></script>
        <script>
          aframeFrustumLockComponent(window.AFRAME);
        </script>
        <script>
            AFRAME.registerComponent("listener", {
        init: function() {
            this.target = document.querySelector('#pallet'); // your video
            this.prevPosition = null; // initially there is no position or rotation
            this.prevRotation = null;
        },

        tick: function() {
            if (this.el.object3D.visible) {
            this.target.setAttribute('visible', 'true')

            if(!this.prevPosition && !this.prevRotation) { 
                // there are no values to lerp from - set the initial values
                this.target.setAttribute('position', this.el.getAttribute('position'))
                this.target.setAttribute('rotation', this.el.getAttribute('rotation'))
            } else {
                // use the previous values to get an approximation 
                this.target.object3D.position.lerp(this.prevPosition, 0.1)

                // this (below) may seem ugly, but the rotation is a euler, not a THREE.Vector3, 
             //   // so to use the lerp function i'm doing some probably unnecessary conversions
               let rot = this.target.object3D.rotation.toVector3().lerp(this.prevRotation, 0.1)
                this.target.object3D.rotation.setFromVector3(rot)
            }
            // update the values
            this.prevPosition = this.el.object3D.position
            this.prevRotation = this.el.object3D.rotation
            } else {
            // the marker dissapeared - reset the values
            this.target.setAttribute('visible', 'false')
            this.prevPosition = null;
            this.prevRotation = null;
        }
        }
        })
        </script>
        <script>
            var detectedQR = false;

            AFRAME.registerComponent("markercomp", {
                init: function () {
                    var marker = document.querySelector("#marker");
                    marker.addEventListener("markerFound", function () {
                            console.log("MARKER DETECTED");
            
                         //displayEntity("#pallet","#marker");
 
                            
                    });

                    marker.addEventListener("markerLost", function () {
                            console.log("MARKER LOST");
                          //  removeEntity("#pallet");
                    });
                
            
                }
            });

            function displayEntity(e_id,m_id) {

                var el = document.querySelector(e_id);
                
                if(!detectedQR){
                    el.setAttribute("visible", true);
                    detectedQR=true;
                } 
                
                var mel = document.querySelector(m_id);
                
            }
            

           function removeEntity(e_id) {
                var el = document.querySelector(e_id);

            }

        </script>

    </head>
    <body style="margin : 0px; overflow: hidden;">

        
        <a-scene embedded arjs="debugUIEnabled: false" 
        renderer="logarithmicDepthBuffer: true;"
        trackingMethod= "best" vr-mode-ui="enabled: false"
        arjs="sourceType: webcam; sourceWidth:1280; sourceHeight:960; displayWidth: 1280; displayHeight: 960;">        
            
            <a-assets>
                <a-asset-item id="3dmodel" src="scene2.gltf"></a-asset-item>
                <img id="logo_img" src="logo_telecmotica.png">
            </a-assets>

            <a-marker smooth="true" smoothCount="10"
            markerhandler emitevents="true"
            id="marker" 
            preset="custom" type="pattern" url="custom.patt">
            
                <a-entity gltf-model="#3dmodel" id="pallet"
                scale="0.1 0.1 0.1"
                rotation="0 0 0"
                position="0 0 0"
                visible="true">
                </a-entity>

                <a-image id="logo"
                position="0 3 0"
                scale="1 1 2"
                animation="property: rotation; dur: 15000; to: 0 360 0; loop: true"
                src="#logo_img">
                </a-image>
                 
            </a-marker>
        
            <a-entity camera id="cameraSRC" camera="far:100000; near:0.01"></a-entity>
        
        </a-scene>

    </body>
</html>