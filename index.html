<!DOCTYPE html>
<html>
    <head>

        <!-- script de A-Frane version1 1.0.0 -->
        <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
        <!-- script de AR.JS con soporte de marker + location -->
        <script src="https://jeromeetienne.github.io/AR.js/aframe/build/aframe-ar.js"></script>
       
        <script>
            var detectedQR = false;
            var lastPosition;
            var lastRotation;
            AFRAME.registerComponent("markercomp", {
                init: function () {
                    var marker = document.querySelector("#marker");
                    marker.addEventListener("markerFound", function () {
                            console.log("MARKER DETECTED");
            
                         displayEntity("#pallet","#marker");
                         
                     
                            
                    });

                    marker.addEventListener("markerLost", function () {
                            console.log("MARKER LOST");
                            removeEntity("#pallet");
                    });
                
            
                }
            });

    /*        AFRAME.registerComponent("move", {
                tick: function() {
                    let obj3d = document.querySelector("#marker");
                     console.log("ENCONTRADO MARKER TRACKING" + obj3d);
                    this.el.object3D.setRotationFromQuaternion(obj3d.object3D.quaternion);
                    this.el.object3D.position.set(obj3d.object3D.position.x, obj3d.object3D.position.y, obj3d.object3D.position.z);
                }
            });*/

            function displayEntity(e_id,m_id) {

                
                var el = document.querySelector(e_id);
                
                if(!detectedQR){
                    el.setAttribute("visible", true);
                    detectedQR=true;
                } 
                
                var mel = document.querySelector(m_id);
                lastPosition = mel.getAttribute("position");
                lastRotation = mel.getAttribute("rotation");
                
                el.setAttribute("position",lastPosition);
                el.setAttribute("rotation",lastRotation);
                console.log("AYAYAYAYYA"+lastPosition.x);
                
                //let obj3d = document.querySelector("#marker");
                //el.object3D.setRotationFromQuaternion(obj3d.object3D.quaternion);
                //el.object3D.position.set(obj3d.object3D.position.x, obj3d.object3D.position.y, obj3d.object3D.position.z);
                //var m_position = mel.getAttribute("position");
                //el.setAttribute("position",{x:obj3d.x,y:obj3d.y,z:obj3d.z});
                
            }
            

           function removeEntity(e_id) {
                var el = document.querySelector(e_id);
                el.setAttribute("position",lastPosition);
                el.setAttribute("rotation",lastRotation);
                el.setAttribute("visible", true);           
               // console.log("NONONONONO" );
            }

        </script>

    </head>
    <body style="margin : 0px; overflow: hidden;">

        
        <a-scene embedded arjs="debugUIEnabled: false" trackingMethod= "best" vr-mode-ui="enabled: false">        
            
            <a-assets>
                <a-asset-item id="3dmodel" src="scene.gltf"></a-asset-item>
                <img id="logo_img" src="logo_telecmotica.png">
            </a-assets>
            
            
            <a-entity gltf-model="#3dmodel" id="pallet"
            scale="0.1 0.1 0.1"
            rotation="90,0,0"
            visible="false">
                <a-image id="logo"
                position="0 3 0"
                scale="1 1 2"
                animation="property: rotation; dur: 15000; to: 0 360 0; loop: true"
                src="#logo_img">
                </a-image>
            </a-entity>
        
        
        <a-marker-camera markercomp
        markerhandler emitevents="true"
        id="marker" 
        preset="custom" type="pattern" url="custom.patt">
        </a-marker>
        
       
        
        </a-scene>

    </body>
</html>